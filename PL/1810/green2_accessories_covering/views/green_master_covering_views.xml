<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Inherit Green Master form to add covering configuration -->
    <record id="view_green_master_form_covering_inherit" model="ir.ui.view">
        <field name="name">green.master.form.covering.inherit</field>
        <field name="model">green.master</field>
        <field name="inherit_id" ref="green2_accessories_base.view_green_master_form_accessories_base_inherit"/>
        <field name="arch" type="xml">
            
            <!-- Add covering configuration to Accessories Management page -->
            <xpath expr="//page[last()]/div[@class='alert alert-info']" position="after">
                
                <!-- Covering Material Configuration Section -->
                <group string="üè† Covering Material Configuration">
                    <group string="Basic Settings">
                        <field name="calculate_covering_material" widget="boolean_toggle"/>
                        <field name="is_apron" widget="boolean_toggle" 
                               invisible="not calculate_covering_material"/>
                        <field name="apron_width_id" 
                               invisible="not calculate_covering_material or not is_apron"
                               options="{'no_create_edit': True}"/>
                        <field name="calculate_insect_net" widget="boolean_toggle"
                               invisible="not calculate_covering_material"/>
                        <field name="insect_net_width_id"
                               invisible="not calculate_covering_material or not calculate_insect_net"
                               options="{'no_create_edit': True}"/>
                    </group>
                    
                    <group string="ASC Configuration (from ASC Module)" invisible="not calculate_covering_material or not is_side_coridoors">
                        <field name="width_front_span_coridoor" readonly="1" string="Front Span ASC Width"/>
                        <field name="width_back_span_coridoor" readonly="1" string="Back Span ASC Width"/>
                        <field name="width_front_bay_coridoor" readonly="1" string="Front Bay ASC Width"/>
                        <field name="width_back_bay_coridoor" readonly="1" string="Back Bay ASC Width"/>
                    </group>
                    
                    <group string="Chamber Configuration (from Doors Module)" invisible="not calculate_covering_material or not has_doors">
                        <field name="entry_chambers_count" readonly="1" string="Number of Chambers"/>
                    </group>
                    
                    <group invisible="not calculate_covering_material">
                        <button name="action_calculate_covering" 
                                string="üè† Calculate Covering Only" 
                                type="object" 
                                class="btn-success"
                                help="Calculate only covering material components"/>
                    </group>
                </group>
                
                <!-- Covering Calculation Logic Info -->
                <separator string="Covering Calculation Logic" 
                          invisible="not calculate_covering_material"/>
                <div invisible="not calculate_covering_material" class="alert alert-info">
                    <h5>‚ÑπÔ∏è Covering Material Calculation Information</h5>
                    <ul>
                        <li>
                            <strong>Big Arch Plastic Covering:</strong><br/>
                            ‚Ä¢ Length: Span Length + 1<br/>
                            ‚Ä¢ Number of Rolls: Number of Spans<br/>
                            ‚Ä¢ Width: Big Arch Length (rounded up to available width)
                        </li>
                        <li>
                            <strong>Small Arch Plastic Covering:</strong><br/>
                            ‚Ä¢ Length: Span Length + 1<br/>
                            ‚Ä¢ Number of Rolls: Number of Spans<br/>
                            ‚Ä¢ Width: Small Arch Length (rounded up to available width)
                        </li>
                        <li>
                            <strong>Front and Back Span Covering:</strong><br/>
                            ‚Ä¢ Length: Bay Length + 1<br/>
                            ‚Ä¢ Number of Rolls: 1 each (separate components)<br/>
                            ‚Ä¢ Width calculation:
                            <ul>
                                <li invisible="not is_apron">
                                    <strong>With Apron:</strong><br/>
                                    - With ASC: ASC Length - 1<br/>
                                    - Without ASC: Column Length - 1
                                </li>
                                <li invisible="is_apron">
                                    <strong>Without Apron:</strong><br/>
                                    - With ASC: ASC Length + 0.5<br/>
                                    - Without ASC: Column Length + 0.5
                                </li>
                            </ul>
                        </li>
                        <li>
                            <strong>Front and Back Bay Covering:</strong><br/>
                            ‚Ä¢ Length: Span Length + 1<br/>
                            ‚Ä¢ Number of Rolls: 1 each (separate components)<br/>
                            ‚Ä¢ Width: Same logic as Span covering
                        </li>
                        <li>
                            <strong>Front &amp; Back Gable Plastic Covering:</strong><br/>
                            ‚Ä¢ Length: Bay Length + 1<br/>
                            ‚Ä¢ Number of Rolls: 2<br/>
                            ‚Ä¢ Width: (Top Ridge Height - Column Height + 0.5)
                        </li>
                        <li invisible="not is_side_coridoors">
                            <strong>Side Corridor Corner Plastic Covering:</strong><br/>
                            ‚Ä¢ Length: sqrt((ASC Width √ó ASC Width) √ó 2) + 1<br/>
                            ‚Ä¢ Number of Rolls: (No of Corridors + 1) max 4<br/>
                            ‚Ä¢ Width: ASC Pipe Length + 0.5
                        </li>
                        <li invisible="not has_doors">
                            <strong>Entry Chambers Plastic Covering:</strong><br/>
                            ‚Ä¢ Length: 25m<br/>
                            ‚Ä¢ Number of Rolls: Number of Chambers<br/>
                            ‚Ä¢ Width: 4.5m
                        </li>
                        <li invisible="not is_apron">
                            <strong>Apron Plastic Covering:</strong><br/>
                            ‚Ä¢ Length: ((Span Length + 1) + (Bay Length + 1)) √ó 2<br/>
                            ‚Ä¢ Number of Rolls: 1<br/>
                            ‚Ä¢ Width: Selectable (1.5m or 2.0m with pricing)
                        </li>
                        <li invisible="not calculate_insect_net">
                            <strong>Insect Net Covering:</strong><br/>
                            ‚Ä¢ Length: ((Span Length + 1) + (Bay Length + 1)) √ó 2<br/>
                            ‚Ä¢ Number of Rolls: 1<br/>
                            ‚Ä¢ Width: Selectable (2.5m / 3.2m / 3.6m / 4.2m with pricing)
                        </li>
                    </ul>
                    
                    <div class="mt-2">
                        <strong>Current Configuration:</strong><br/>
                        <span invisible="not is_apron">‚úÖ Apron: Enabled (<field name="apron_width_id" readonly="1" nolabel="1" class="oe_inline"/>)</span>
                        <span invisible="is_apron">‚ùå Apron: Disabled</span><br/>
                        <span invisible="not calculate_insect_net">‚úÖ Insect Net: Enabled (<field name="insect_net_width_id" readonly="1" nolabel="1" class="oe_inline"/>)</span>
                        <span invisible="calculate_insect_net">‚ùå Insect Net: Disabled</span><br/>
                        <span invisible="not is_side_coridoors">‚úÖ ASC: Enabled</span>
                        <span invisible="is_side_coridoors">‚ùå ASC: Disabled</span><br/>
                        <span invisible="not has_doors">‚úÖ Doors/Chambers: Enabled</span>
                        <span invisible="has_doors">‚ùå Doors/Chambers: Disabled</span>
                    </div>
                </div>
                
            </xpath>
            
            <!-- Add covering components display in Accessories Management page -->
            <xpath expr="//div[@class='card border-warning mb-4'][div[@class='card-header bg-warning text-white text-center']]" position="before">
                <div class="card mb-4" invisible="not calculate_covering_material or not covering_component_ids">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">üè† Covering Material Components</h4>
                    </div>
                    <div class="card-body">
                        <field name="covering_component_ids" readonly="0">
                            <tree editable="bottom" decoration-info="is_calculated==True">
                                <field name="sequence" widget="handle"/>
                                <field name="name"/>
                                <field name="length" string="Length (m)"/>
                                <field name="width" string="Width (m)"/>
                                <field name="nos" string="Rolls" sum="Total Rolls"/>
                                <field name="quantity" string="Quantity (m¬≤)" sum="Total m¬≤"/>
                                <field name="size_specification"/>
                                <field name="accessories_master_id" options="{'no_create_edit': True}" 
                                       placeholder="Select from Master (optional)"/>
                                <field name="unit_price" string="Rate/m¬≤" widget="monetary"/>
                                <field name="total_cost" readonly="1" sum="Total" widget="monetary"/>
                                <field name="notes" placeholder="Add notes"/>
                                <field name="section" column_invisible="1"/>
                                <field name="is_calculated" column_invisible="1"/>
                            </tree>
                        </field>
                        <div class="text-right mt-2">
                            <h5 class="text-success">Covering Total: 
                                <field name="total_covering_cost" readonly="1" widget="monetary"/>
                            </h5>
                        </div>
                    </div>
                </div>
            </xpath>
            
            <!-- Add to cost summary table -->
            <xpath expr="//tr[@name='cost_summary_rows']" position="after">
                <tr class="table-success" invisible="not calculate_covering_material or total_covering_cost == 0">
                    <td><strong>üè† COVERING MATERIAL</strong></td>
                    <td class="text-right">
                        <field name="total_covering_cost" readonly="1" widget="monetary"/>
                    </td>
                </tr>
            </xpath>
            
            <!-- Update accessories total to include covering -->
            <xpath expr="//div[@class='card border-warning mb-4']/div[@class='card-header bg-warning text-white text-center']/h3" position="replace">
                <h3 class="mb-0">
                    üîß ACCESSORIES TOTAL (
                    <span invisible="not calculate_covering_material">incl. Covering</span>
                    <span invisible="calculate_covering_material">excl. Covering</span>
                    ): <field name="total_accessories_cost" readonly="1" widget="monetary"/>
                </h3>
            </xpath>
            
        </field>
    </record>
    
    <!-- Tree view customization for covering visibility -->
    <record id="view_green_master_tree_covering_inherit" model="ir.ui.view">
        <field name="name">green.master.tree.covering.inherit</field>
        <field name="model">green.master</field>
        <field name="inherit_id" ref="green2_base.view_green_master_tree"/>
        <field name="arch" type="xml">
            <field name="grand_total_cost" position="before">
                <field name="total_covering_cost" optional="hide" string="Covering Cost"/>
            </field>
        </field>
    </record>
    
    <!-- Covering Width Management Views -->
    <record id="view_covering_width_tree" model="ir.ui.view">
        <field name="name">covering.width.tree</field>
        <field name="model">covering.width</field>
        <field name="arch" type="xml">
            <tree decoration-muted="not active">
                <field name="width_value"/>
                <field name="notes"/>
                <field name="active" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>
    
    <record id="view_covering_width_form" model="ir.ui.view">
        <field name="name">covering.width.form</field>
        <field name="model">covering.width</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="width_value" string="Covering Width"/>
                        <h1>
                            <field name="width_value" class="oe_inline"/> m
                        </h1>
                    </div>
                    <group>
                        <field name="notes" placeholder="Add any notes about this width"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Apron Width Management Views -->
    <record id="view_apron_width_tree" model="ir.ui.view">
        <field name="name">apron.width.tree</field>
        <field name="model">apron.width</field>
        <field name="arch" type="xml">
            <tree decoration-muted="not active">
                <field name="width_value"/>
                <field name="unit_price" widget="monetary"/>
                <field name="notes"/>
                <field name="active" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>
    
    <record id="view_apron_width_form" model="ir.ui.view">
        <field name="name">apron.width.form</field>
        <field name="model">apron.width</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="width_value" string="Apron Width"/>
                        <h1>
                            <field name="width_value" class="oe_inline"/> m
                        </h1>
                    </div>
                    <group>
                        <field name="unit_price" widget="monetary"/>
                        <field name="notes" placeholder="Add any notes about this width"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Insect Net Width Management Views -->
    <record id="view_insect_net_width_tree" model="ir.ui.view">
        <field name="name">insect.net.width.tree</field>
        <field name="model">insect.net.width</field>
        <field name="arch" type="xml">
            <tree decoration-muted="not active">
                <field name="width_value"/>
                <field name="unit_price" widget="monetary"/>
                <field name="notes"/>
                <field name="active" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>
    
    <record id="view_insect_net_width_form" model="ir.ui.view">
        <field name="name">insect.net.width.form</field>
        <field name="model">insect.net.width</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="width_value" string="Insect Net Width"/>
                        <h1>
                            <field name="width_value" class="oe_inline"/> m
                        </h1>
                    </div>
                    <group>
                        <field name="unit_price" widget="monetary"/>
                        <field name="notes" placeholder="Add any notes about this width"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Actions -->
    <record id="action_covering_width" model="ir.actions.act_window">
        <field name="name">Available Covering Widths</field>
        <field name="res_model">covering.width</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_active': 1}</field>
    </record>
    
    <record id="action_apron_width" model="ir.actions.act_window">
        <field name="name">Apron Widths</field>
        <field name="res_model">apron.width</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_active': 1}</field>
    </record>
    
    <record id="action_insect_net_width" model="ir.actions.act_window">
        <field name="name">Insect Net Widths</field>
        <field name="res_model">insect.net.width</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_active': 1}</field>
    </record>
    
    <!-- Menu for Covering Width Management -->
    <menuitem id="menu_covering_widths" 
              name="Covering Widths" 
              parent="green2_accessories_base.menu_accessories_master_main" 
              action="action_covering_width" 
              sequence="50"/>
              
    <menuitem id="menu_apron_widths" 
              name="Apron Widths" 
              parent="green2_accessories_base.menu_accessories_master_main" 
              action="action_apron_width" 
              sequence="51"/>
              
    <menuitem id="menu_insect_net_widths" 
              name="Insect Net Widths" 
              parent="green2_accessories_base.menu_accessories_master_main" 
              action="action_insect_net_width" 
              sequence="52"/>
    
</odoo>