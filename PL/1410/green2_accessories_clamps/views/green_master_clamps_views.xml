<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Inherit Green Master form to add clamp configuration -->
    <record id="view_green_master_form_clamps_inherit" model="ir.ui.view">
        <field name="name">green.master.form.clamps.inherit</field>
        <field name="model">green.master</field>
        <field name="inherit_id" ref="green2_accessories_base.view_green_master_form_accessories_base_inherit"/>
        <field name="arch" type="xml">
            
            <!-- Add clamp configuration section -->
            <xpath expr="//page[position()=last()]/div[@class='alert alert-info']" position="after">
                
                <!-- Advanced Clamp Configuration -->
                <group string="Advanced Clamp Configuration">
                    <group col="2">
                        <!-- Show clamp type as readonly, computed from arch_support_type -->
                        <field name="arch_support_type" invisible="1"/>
                        <field name="clamp_type" string="Clamp Type (Auto-set from Arch Support Type)" readonly="1" colspan="2"/>
                        <div class="alert alert-warning" colspan="2">
                            <strong>Note:</strong> Clamp type is automatically set based on the Arch Support Type selection in Truss Configuration.
                            <ul>
                                <li>Arch Support Type "W" ‚Üí W Type Clamps</li>
                                <li>Arch Support Type "M" ‚Üí M Type Clamps</li>
                                <li>Arch Support Type "Arch to Bottom/Straight" ‚Üí Special clamp calculations</li>
                                <li>Arch Support Type "None" ‚Üí No standard clamps</li>
                            </ul>
                        </div>
                    </group>
                    
                    <!-- M Type Specific Configuration -->
                    <group invisible="clamp_type != 'm_type'" col="2">
                        <separator string="M Type Settings" colspan="2"/>
                        <field name="bottom_chord_clamp_type" widget="radio" colspan="2"/>
                    </group>
                    
                    <!-- Purlin Clamps Configuration (for both W and M types) -->
                    <group invisible="clamp_type not in ['w_type', 'm_type']" string="Purlin Clamps Configuration (Arch Middle Purlin)">
                        <div class="alert alert-info" colspan="2">
                            <strong>Important:</strong>
                            <ul>
                                <li>Big Purlin clamps apply to <b>Arch Middle Purlin Big Arch</b> components</li>
                                <li>Small Purlin clamps apply to <b>Arch Middle Purlin Small Arch</b> components</li>
                                <li>If First Type is selected, Second Type is <b>mandatory</b></li>
                                <li>First Type quantity: No. of Spans √ó 2</li>
                                <li>Second Type quantity: Remaining (Total - First Type quantity)</li>
                            </ul>
                        </div>
                        
                        <field name="big_purlin_clamp_type_first" string="Big Purlin First Type" colspan="2"/>
                        <field name="small_purlin_clamp_type_first" string="Small Purlin First Type" colspan="2"/>
                        <field name="big_purlin_clamp_type_second" 
                               string="Big Purlin Second Type" 
                               colspan="2"
                               required="big_purlin_clamp_type_first != False" 
                               invisible="big_purlin_clamp_type_first == False"/>
                        <field name="small_purlin_clamp_type_second" 
                               string="Small Purlin Second Type" 
                               colspan="2"
                               required="small_purlin_clamp_type_first != False"
                               invisible="small_purlin_clamp_type_first == False"/>
                    </group>
                    
                    <!-- Special clamp info for Arch to Bottom/Straight -->
                    <group string="Special Clamp Calculations" invisible="arch_support_type not in ['arch_2_bottom', 'arch_2_straight']">
                        <div class="alert alert-success" colspan="2" invisible="arch_support_type != 'arch_2_bottom'">
                            <strong>Arch to Bottom Support Clamps:</strong>
                            <ul>
                                <li>Full Clamps = No. of Arch Support √ó 1 (Bottom Pipe size)</li>
                                <li>Full Clamps = No. of Arch Support √∑ 2 (Big Arch Pipe size)</li>
                                <li>Full Clamps = No. of Arch Support √∑ 2 (Small Arch Pipe size)</li>
                                <li>Additional clamps for Arch Support Straight Middle components</li>
                            </ul>
                        </div>
                        <div class="alert alert-primary" colspan="2" invisible="arch_support_type != 'arch_2_straight'">
                            <strong>Arch to Straight Middle Clamps:</strong>
                            <ul>
                                <li>Full Clamps = No. of Arch Support √ó 1 (Bottom Pipe size)</li>
                                <li>Full Clamps = No. of Arch Support √∑ 2 (Big Arch Pipe size)</li>
                                <li>Full Clamps = No. of Arch Support √∑ 2 (Small Arch Pipe size)</li>
                                <li>Full Clamps = No. of Arch Support Straight Middle (Big Arch Pipe size)</li>
                            </ul>
                        </div>
                    </group>
                    
                    <!-- ENHANCED: ASC Clamp Configuration -->
<group string="üèóÔ∏è ASC (Side Corridors) Clamp Configuration" invisible="not is_side_coridoors" col="2">
    
    <!-- Warning for No Bracket Type Selected -->
    <div class="alert alert-warning" colspan="2" invisible="gutter_bracket_type != 'none'">
        <h6><strong>‚ö†Ô∏è Notice: No Bracket Type Selected</strong></h6>
        <p><b>ASC is enabled but no Gutter Bracket Type is selected.</b></p>
        <p><strong>Default Behavior:</strong> Clamps will be calculated for ALL present ASC sides (conservative approach):</p>
        <ul>
            <li invisible="not front_span_asc">‚úÖ Front Span ASC clamps will be calculated</li>
            <li invisible="not back_span_asc">‚úÖ Back Span ASC clamps will be calculated</li>
            <li invisible="not front_bay_asc">‚úÖ Front Bay ASC clamps will be calculated</li>
            <li invisible="not back_bay_asc">‚úÖ Back Bay ASC clamps will be calculated</li>
            <li invisible="front_span_asc or back_span_asc or front_bay_asc or back_bay_asc">‚ÑπÔ∏è No ASC sides detected</li>
        </ul>
        <p class="text-danger"><b>Recommendation:</b> Select F Bracket or Gutter Arch Bracket in Brackets Configuration for precise control.</p>
    </div>
    
    <!-- ASC Clamp Information Box -->
    <div class="alert alert-info" colspan="2" invisible="gutter_bracket_type == 'none'">
        <h5><strong>ASC Clamps Calculation Method</strong></h5>
        <p>Clamps are calculated based on your gutter bracket type and thick column configuration:</p>
    </div>
    
    <!-- Gutter Bracket Type Info (CORRECTED) -->
    <field name="gutter_bracket_type" readonly="1" string="Gutter Bracket Type" 
           help="Set in Brackets Configuration" colspan="2"
           decoration-danger="gutter_bracket_type == 'none'"
           class="font-weight-bold"/>
    
    <!-- F Bracket Info -->
    <div class="alert alert-warning" colspan="2" invisible="gutter_bracket_type != 'f_bracket'">
        <h6><strong>üìê F Bracket Configuration</strong></h6>
        <ul>
            <li><b>Span Side ONLY:</b> Clamps calculated for span side ASC</li>
            <li><b>Bay Side:</b> No clamps required (F Brackets don't need bay side clamps)</li>
            <li><b>Clamp Types:</b> Full Clamps based on column configuration</li>
            <li><b>Sizing:</b> Determined by column type (Main/Thick/AF columns)</li>
        </ul>
    </div>
    
    <!-- Gutter Arch Bracket Info -->
    <div class="alert alert-success" colspan="2" invisible="gutter_bracket_type != 'arch'">
        <h6><strong>üèõÔ∏è Gutter Arch Bracket Configuration</strong></h6>
        <p><b>Bay Side Clamp Control:</b> You can enable/disable bay side clamps below</p>
        <ul>
            <li><b>Span Side:</b> Always calculated when ASC present</li>
            <li><b>Bay Side:</b> Optional - enable with checkbox below</li>
            <li><b>Clamp Types:</b> Full Clamps at positions, Half Clamps at intermediates</li>
            <li><b>Sizing:</b> Based on column type and thick column position</li>
        </ul>
    </div>
    
    <!-- Bay Side Clamp Required (Only for Gutter Arch Brackets) -->
    <group colspan="2" invisible="gutter_bracket_type != 'arch'" col="2">
        <separator string="Bay Side Clamp Configuration" colspan="2"/>
        <field name="bay_side_clamp_required" 
               widget="boolean_toggle" 
               string="Calculate Bay Side Clamps?"
               help="Enable this to calculate clamps for bay side ASC (only for Gutter Arch Brackets)"/>
        <div class="text-info" colspan="2" invisible="not bay_side_clamp_required">
            ‚úÖ <strong>Bay Side Clamps ENABLED:</strong> Clamps will be calculated for both span and bay sides
        </div>
        <div class="text-muted" colspan="2" invisible="bay_side_clamp_required">
            ‚õî <strong>Bay Side Clamps DISABLED:</strong> Only span side clamps will be calculated
        </div>
    </group>
	
<!-- ADD to green2_accessories_clamps/views/green_master_clamps_views.xml -->
<!-- After the Border Purlin Configuration section and before the ASC configuration -->

<!-- AFX Configuration for Cross Bracing (Only shown when AF Lines > 2) -->
<group string="üî© AFX Configuration (Cross Bracing AF Lines)" invisible="not show_afx_fields" col="2">
    <div class="alert alert-warning" colspan="2">
        <h6><strong>‚ö†Ô∏è Advanced AF Line Configuration</strong></h6>
        <p>Since you have more than 2 Anchor Frame Lines, please specify how many AF lines fall in each cross bracing type:</p>
    </div>
    
    <separator string="AFX Line Distribution" colspan="2"/>
    
    <field name="afx2_internal_cc_lines" 
           string="AFX2 - Internal CC Cross Bracing Lines"
           help="Number of AF lines for Internal Column to Column Cross Bracing"/>
    
    <field name="afx3_column_arch_lines" 
           string="AFX3 - Column to Arch Lines (Max 2)"
           help="Number of AF lines for Cross Bracing Column to Arch (Maximum 2)"/>
    
    <field name="afx4_column_bottom_lines" 
           string="AFX4 - Column to Bottom Chord Lines (Max 2)"
           help="Number of AF lines for Cross Bracing Column to Bottom Chord (Maximum 2)"/>
    
    <div class="text-info" colspan="2">
        <p><b>Note:</b> AFX values determine how clamps are distributed between AF columns and Main columns in cross bracing calculations.</p>
    </div>
</group>

<!-- Also add the hidden computed field -->
<field name="show_afx_fields" invisible="1"/>	
	
	
	
	
    
    <!-- ASC Sides Status (Computed Fields) -->
    <separator string="üéØ ASC Sides Status (Auto-detected)" colspan="2"/>
    <div class="alert alert-light" colspan="2">
        <p><strong>Active ASC Sides:</strong> These are automatically detected from your ASC width configuration</p>
    </div>
    
    <group col="4" colspan="2">
        <field name="front_span_asc" widget="boolean_toggle" readonly="1" 
               string="Front Span ASC"/>
        <field name="back_span_asc" widget="boolean_toggle" readonly="1"
               string="Back Span ASC"/>
        <field name="front_bay_asc" widget="boolean_toggle" readonly="1"
               string="Front Bay ASC"/>
        <field name="back_bay_asc" widget="boolean_toggle" readonly="1"
               string="Back Bay ASC"/>
    </group>
    
    <!-- Thick Column Configuration Reference -->
    <separator string="üìä Column Configuration (Reference)" colspan="2"/>
    <field name="thick_column" readonly="1" string="Thick Column Position"
           help="Affects clamp sizing - set in Frame Configuration"/>
    <field name="no_anchor_frame_lines" readonly="1" string="Anchor Frame Lines"
           help="Additional clamps calculated for anchor frames" invisible="no_anchor_frame_lines == 0"/>
    
                        <!-- Calculation Formula Info -->
                        <div class="alert alert-secondary" colspan="2">
                            <h6><strong>üìê Clamp Calculation Formulas:</strong></h6>
                            <p><b>Span Side ASC:</b></p>
                            <ul>
                                <li><b>Thick Column = 4 Corner:</b>
                                    <ul>
                                        <li>Full Clamps (Thick) = 2</li>
                                        <li>Full Clamps (Main) = No. of Spans - 1</li>
                                    </ul>
                                </li>
                                <li><b>Thick Column = 2 Span Side / All 4 Side:</b>
                                    <ul>
                                        <li>Full Clamps (Thick) = No. of Spans + 1</li>
                                    </ul>
                                </li>
                                <li><b>Thick Column = None / 2 Bay Side:</b>
                                    <ul>
                                        <li>Full Clamps (Main) = No. of Spans + 1</li>
                                    </ul>
                                </li>
                                <li><b>Anchor Frames (if applicable):</b>
                                    <ul>
                                        <li>Full Clamps (Big Column) = No. of Spans √ó No. of Big Columns per AF</li>
                                    </ul>
                                </li>
                            </ul>
                            
                            <p><b>Bay Side ASC (if enabled):</b></p>
                            <ul>
                                <li><b>Thick Column = 4 Corner / 2 Span Side:</b>
                                    <ul>
                                        <li>Full Clamps (Thick) = 2</li>
                                        <li>Full Clamps (Main) = No. of Bays - 1</li>
                                    </ul>
                                </li>
                                <li><b>Thick Column = 2 Bay Side / All 4 Side:</b>
                                    <ul>
                                        <li>Full Clamps (Thick) = No. of Bays + 1</li>
                                    </ul>
                                </li>
                                <li><b>Thick Column = None:</b>
                                    <ul>
                                        <li>Full Clamps (Main) = No. of Bays + 1</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Default Behavior Info (when bracket_type = 'none') -->
                        <div class="alert alert-info" colspan="2" invisible="gutter_bracket_type != 'none'">
                            <h6><strong>‚ÑπÔ∏è Default Calculation Mode</strong></h6>
                            <p><b>Since no bracket type is selected, the system will:</b></p>
                            <ul>
                                <li>‚úÖ Calculate clamps for <b>ALL ASC sides that are present</b></li>
                                <li>‚úÖ Use the same formulas as shown above</li>
                                <li>‚úÖ Skip sides where ASC is not present</li>
                                <li>‚ö†Ô∏è This is a <b>conservative approach</b> that may over-estimate clamps</li>
                            </ul>
                            <p class="text-primary"><b>For production:</b> Please select the appropriate bracket type in Brackets Configuration.</p>
                        </div>
                    </group>
                    
                    <group string="Clamp Information">
                        <button name="action_view_clamp_details" 
                                string="üìä View Clamp Details" 
                                type="object" 
                                class="btn-info"
                                colspan="2"
                                help="Show detailed breakdown of clamp calculations including ASC clamps"/>
                        
                        <div class="text-muted" colspan="2">
                            <field name="clamps_size_summary" readonly="1" nolabel="1" invisible="not clamps_size_summary"/>
                        </div>
                        
                        <div class="text-warning" invisible="not border_purlin_clamps_summary" colspan="2">
                            <strong>Border Purlin Config:</strong>
                            <field name="border_purlin_clamps_summary" readonly="1" nolabel="1" class="oe_inline"/>
                        </div>
                    </group>
                </group>
                
            </xpath>
            
            <!-- Update clamps component section to show size information -->
            <xpath expr="//field[@name='clamps_component_ids']/.." position="attributes">
                <attribute name="class">card-body</attribute>
            </xpath>
            
        </field>
    </record>
    
</odoo>