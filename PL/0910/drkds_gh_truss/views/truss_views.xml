<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_greenhouse_project_form_truss" model="ir.ui.view">
        <field name="name">greenhouse.project.form.truss</field>
        <field name="model">greenhouse.project</field>
        <field name="inherit_id" ref="drkds_gh_base.view_greenhouse_project_form"/>
        <field name="arch" type="xml">
            
            <!-- Add Truss Configuration page to notebook -->
            <xpath expr="//page[.//field[@name='no_of_curtains']]" position="after">
                <page string="Truss Configuration" name="truss_config">
                    <group>
                        <group string="Arch Support Configuration">
                            <field name="arch_support_type" widget="radio"/>
                            
                            <!-- Show relevant length fields based on selection -->
                            <field name="length_arch_support_big" 
                                   invisible="arch_support_type not in ['w', 'm', 'arch_2_straight']"/>
                            <field name="length_arch_support_big_small" 
                                   invisible="arch_support_type not in ['w', 'm', 'arch_2_straight']"/>
                            <field name="length_arch_support_small_big_arch" 
                                   invisible="arch_support_type not in ['w', 'm', 'arch_2_bottom']"/>
                            <field name="length_arch_support_small_small_arch" 
                                   invisible="arch_support_type not in ['w', 'm', 'arch_2_bottom']"/>
                        </group>
                        
                        <group string="Truss Summary">
                            <field name="total_truss_cost" readonly="1"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Bottom Chord Settings">
                            <field name="is_bottom_chord"/>
                            <field name="v_support_bottom_chord_frame" invisible="not is_bottom_chord"/>
                            <field name="length_v_support_bottom_chord_frame" invisible="not is_bottom_chord"/>
                        </group>
                        
                        <group string="Vent Support Settings">
                            <field name="no_vent_big_arch_support_frame"/>
                            <field name="length_vent_big_arch_support" invisible="no_vent_big_arch_support_frame == '0'"/>
                            <field name="no_vent_small_arch_support_frame"/>
                            <field name="length_vent_small_arch_support" invisible="no_vent_small_arch_support_frame == '0'"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Purlin Settings">
                            <field name="bay_side_border_purlin"/>
                            <field name="span_side_border_purlin"/>
                        </group>
                        <group string="Gutter Configuration">
                            <field name="gutter_type"/>
                        </group>
                    </group>
                    
                    <!-- Hidden computed fields -->
                    <group invisible="1">
                        <field name="is_arch_support_big"/>
                        <field name="is_arch_support_big_small"/>
                        <field name="is_arch_support_small_big_arch"/>
                        <field name="is_arch_support_small_small_arch"/>
                    </group>
                </page>
            </xpath>
            
            <!-- Add total cost to main view -->
            <field name="grand_total_cost" position="after">
                <field name="total_truss_cost" readonly="1"/>
            </field>
        </field>
    </record>
</odoo>