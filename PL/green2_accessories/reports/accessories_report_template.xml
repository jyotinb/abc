<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Extend Green2's existing report to include accessories -->
    <template id="green_master_report_accessories_extend" inherit_id="green2.green_master_report_template">
        
        <!-- Add accessories section before final cost summary -->
        <xpath expr="//div[contains(@class, 'section-header') and text()='Cost Summary']" position="before">
            
            <!-- Accessories Configuration Summary -->
            <div class="section-header" style="background-color: #f39c12; color: white;">Accessories Configuration</div>
            <table class="component-table">
                <tr>
                    <td style="width: 30%; font-weight: bold;">Gutter Bracket Type:</td>
                    <td style="width: 20%;"><span t-esc="dict(o._fields['gutter_bracket_type'].selection)[o.gutter_bracket_type]"/></td>
                    <td style="width: 30%; font-weight: bold;">Column Bracket Type:</td>
                    <td style="width: 20%;"><span t-esc="dict(o._fields['column_bracket_type'].selection)[o.column_bracket_type]"/></td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Zigzag Wire:</td>
                    <td><span t-esc="'Enabled (' + o.zigzag_wire_size + ')' if o.enable_zigzag_wire else 'Disabled'"/></td>
                    <td style="font-weight: bold;">Roll Up Connectors:</td>
                    <td><span t-esc="'Enabled' if o.enable_rollup_connectors else 'Disabled'"/></td>
                </tr>
            </table>
			
			<!-- Profiles Components -->
				<t t-if="o.profiles_component_ids">
					<div class="section-header" style="background-color: #28a745; color: white;">Profiles Components</div>
					<table class="component-table">
						<thead>
							<tr>
								<th>Component Name</th>
								<th>Quantity</th>
								<th>Size/Type</th>
								<th>Unit Price</th>
								<th>Total Cost</th>
							</tr>
						</thead>
						<tbody>
							<t t-foreach="o.profiles_component_ids" t-as="component">
								<tr>
									<td><span t-esc="component.name"/></td>
									<td><span t-esc="component.nos"/></td>
									<td><span t-esc="component.size_specification or 'N/A'"/></td>
									<td><span t-esc="round(component.unit_price, 2)"/></td>
									<td><span t-esc="round(component.total_cost, 2)"/></td>
								</tr>
							</t>
							<tr class="section-total">
								<td colspan="4" style="text-align: right; font-weight: bold;">Profiles Total:</td>
								<td style="font-weight: bold;"><span t-esc="round(o.total_profiles_cost, 2)"/></td>
							</tr>
						</tbody>
					</table>
				</t>
			
            
            <!-- Brackets Components -->
            <t t-if="o.brackets_component_ids">
                <div class="section-header" style="background-color: #f39c12; color: white;">Brackets Components</div>
                <table class="component-table">
                    <thead>
                        <tr>
                            <th>Component Name</th>
                            <th>Quantity</th>
                            <th>Size/Type</th>
                            <th>Unit Price</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="o.brackets_component_ids" t-as="component">
                            <tr>
                                <td><span t-esc="component.name"/></td>
                                <td><span t-esc="component.nos"/></td>
                                <td><span t-esc="component.size_specification or 'N/A'"/></td>
                                <td><span t-esc="round(component.unit_price, 2)"/></td>
                                <td><span t-esc="round(component.total_cost, 2)"/></td>
                            </tr>
                        </t>
                        <tr class="section-total">
                            <td colspan="4" style="text-align: right; font-weight: bold;">Brackets Total:</td>
                            <td style="font-weight: bold;"><span t-esc="round(o.total_brackets_cost, 2)"/></td>
                        </tr>
                    </tbody>
                </table>
            </t>
            
            <!-- Wires & Connectors Components -->
            <t t-if="o.wires_connectors_component_ids">
                <div class="section-header" style="background-color: #17a2b8; color: white;">Wires &amp; Connectors Components</div>
                <table class="component-table">
                    <thead>
                        <tr>
                            <th>Component Name</th>
                            <th>Quantity</th>
                            <th>Size/Type</th>
                            <th>Unit Price</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="o.wires_connectors_component_ids" t-as="component">
                            <tr>
                                <td><span t-esc="component.name"/></td>
                                <td><span t-esc="component.nos"/></td>
                                <td><span t-esc="component.size_specification or 'N/A'"/></td>
                                <td><span t-esc="round(component.unit_price, 2)"/></td>
                                <td><span t-esc="round(component.total_cost, 2)"/></td>
                            </tr>
                        </t>
                        <tr class="section-total">
                            <td colspan="4" style="text-align: right; font-weight: bold;">Wires &amp; Connectors Total:</td>
                            <td style="font-weight: bold;"><span t-esc="round(o.total_wires_connectors_cost, 2)"/></td>
                        </tr>
                    </tbody>
                </table>
            </t>
            
            <!-- Clamps Components -->
            <t t-if="o.clamps_component_ids">
                <div class="section-header" style="background-color: #6c757d; color: white;">Clamps Components</div>
                <table class="component-table">
                    <thead>
                        <tr>
                            <th>Component Name</th>
                            <th>Quantity</th>
                            <th>Size/Type</th>
                            <th>Auto-Detected Size</th>
                            <th>Size Override</th>
                            <th>Unit Price</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="o.clamps_component_ids" t-as="component">
                            <tr>
                                <td><span t-esc="component.name"/></td>
                                <td><span t-esc="component.nos"/></td>
                                <td><span t-esc="component.size_specification or 'N/A'"/></td>
                                <td><span t-esc="component.auto_detected_size or 'N/A'"/></td>
                                <td><span t-esc="'Yes' if component.size_override else 'No'"/></td>
                                <td><span t-esc="round(component.unit_price, 2)"/></td>
                                <td><span t-esc="round(component.total_cost, 2)"/></td>
                            </tr>
                        </t>
                        <tr class="section-total">
                            <td colspan="6" style="text-align: right; font-weight: bold;">Clamps Total:</td>
                            <td style="font-weight: bold;"><span t-esc="round(o.total_clamps_cost, 2)"/></td>
                        </tr>
                    </tbody>
                </table>
            </t>
            
            <!-- Accessories Summary -->
            <div class="section-header" style="background-color: #f39c12; color: white;">Accessories Summary</div>
            <table class="component-table">
                <thead>
                    <tr>
                        <th style="width: 70%;">Accessories Type</th>
                        <th style="width: 30%; text-align: right;">Total Cost</th>
                    </tr>
                </thead>
                <tbody>
					<tr t-if="o.total_profiles_cost > 0">
						<td>üìè Profiles Components</td>
						<td style="text-align: right;"><span t-esc="round(o.total_profiles_cost, 2)"/></td>
					</tr>
                    <tr t-if="o.total_brackets_cost > 0">
                        <td>üîß Brackets Components</td>
                        <td style="text-align: right;"><span t-esc="round(o.total_brackets_cost, 2)"/></td>
                    </tr>
                    <tr t-if="o.total_wires_connectors_cost > 0">
                        <td>üîó Wires &amp; Connectors Components</td>
                        <td style="text-align: right;"><span t-esc="round(o.total_wires_connectors_cost, 2)"/></td>
                    </tr>
                    <tr t-if="o.total_clamps_cost > 0">
                        <td>üõ†Ô∏è Clamps Components</td>
                        <td style="text-align: right;"><span t-esc="round(o.total_clamps_cost, 2)"/></td>
                    </tr>
                    <tr class="total-row">
                        <td style="font-size: 16px;">üîß TOTAL ACCESSORIES</td>
                        <td style="text-align: right; font-size: 16px;"><span t-esc="round(o.total_accessories_cost, 2)"/></td>
                    </tr>
                </tbody>
            </table>
            
        </xpath>
        
        <!-- Update main cost summary to include accessories -->
        <xpath expr="//tr[contains(@class, 'total-row') and .//text()[contains(., 'GRAND TOTAL')]]" position="before">
            <tr t-if="o.total_accessories_cost > 0">
                <td>üîß Accessories Components</td>
                <td style="text-align: right;"><span t-esc="round(o.total_accessories_cost, 2)"/></td>
            </tr>
        </xpath>
        
        <!-- Update final statistics to include accessories -->
        <xpath expr="//td[contains(text(), 'No of Curtains:')]" position="after">
            <tr t-if="o.total_accessories_cost > 0">
                <td style="font-weight: bold;">Total Accessories Cost:</td>
                <td><span t-esc="round(o.total_accessories_cost, 2)"/></td>
            </tr>
            <tr t-if="o.total_accessories_cost > 0">
                <td style="font-weight: bold;">Accessories Components Count:</td>
                <td><span t-esc="len(o.accessories_component_ids)"/></td>
            </tr>
        </xpath>
        
    </template>
    
</odoo>