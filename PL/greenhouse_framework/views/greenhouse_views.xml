<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Sequence for Project Reference -->
    <record id="seq_greenhouse_project" model="ir.sequence">
        <field name="name">Greenhouse Project</field>
        <field name="code">greenhouse.project</field>
        <field name="prefix">GH/</field>
        <field name="padding">5</field>
        <field name="company_id" eval="False"/>
    </record>

    <!-- GREENHOUSE PROJECT FORM VIEW -->
    <record id="view_greenhouse_project_form" model="ir.ui.view">
        <field name="name">greenhouse.project.form</field>
        <field name="model">greenhouse.project</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_calculate" string="ðŸ“Š Calculate" type="object" class="btn-primary"
                            invisible="state != 'draft'" confirm="This will calculate all components. Continue?"/>
                    <button name="action_confirm" string="âœ… Confirm" type="object" class="btn-success"
                            invisible="state != 'calculated'"/>
                    <button name="action_reset" string="ðŸ”„ Reset to Draft" type="object"
                            invisible="state == 'draft'" confirm="This will clear all calculations. Continue?"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,calculated,confirmed"/>
                </header>
                <sheet>
					        <field name="needs_recalculation" invisible="1"/>

                    <div class="alert alert-warning" role="alert" invisible="not needs_recalculation or state != 'calculated'">
                        <i class="fa fa-warning"/> Input values have changed. Please recalculate!
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="reference" readonly="1" invisible="not reference or reference == 'New'"/>
                            <field name="name" placeholder="Project Name" required="1"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Customer Information">
                            <field name="customer_name"/>
                            <field name="customer_mobile" widget="phone"/>
                            <field name="customer_email" widget="email"/>
                        </group>
                        <group string="Project Information">
                            <field name="greenhouse_type_id" options="{'no_create': True}"/>
                            <field name="project_date"/>
                            <field name="calculation_date" readonly="1" invisible="not calculation_date"/>
                        </group>
                    </group>
                    <field name="customer_address" placeholder="Customer Address..."/>
                    <notebook>
                        <page string="ðŸ“ Input Sheet" name="inputs">
                            <div class="alert alert-info" role="alert">
                                <i class="fa fa-info-circle"/> Enter your values below. The system will calculate automatically when you click Calculate.
                            </div>
                            <field name="active_section_ids" invisible="1"/>
                            <field name="input_value_ids" nolabel="1">
                                <tree editable="bottom" create="false" delete="false">
                                    <field name="section_id" optional="show"/>
                                    <field name="field_label" readonly="1"/>
                                    <field name="value" string="Value"/>
                                    <field name="field_type" column_invisible="1"/>
                                    <field name="help_text" optional="hide"/>
                                    <field name="sequence" column_invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        <page string="ðŸ“‹ Results Sheet" name="results">
                            <div invisible="state == 'draft'" class="alert alert-success" role="alert">
                                <i class="fa fa-check-circle"/> Calculated on <field name="calculation_date" readonly="1"/>
                            </div>
                            <div invisible="state != 'draft'" class="alert alert-warning" role="alert">
                                <i class="fa fa-calculator"/> Please click Calculate to generate results.
                            </div>
                            <field name="component_result_ids" readonly="1" nolabel="1">
                                <tree create="false" delete="false">
                                    <field name="section_id"/>
                                    <field name="name"/>
                                    <field name="quantity" sum="Total"/>
                                    <field name="length"/>
                                    <field name="total_length" sum="Total"/>
                                    <field name="unit_cost"/>
                                    <field name="total_cost" sum="Grand Total" widget="monetary"/>
                                    <field name="pipe_selected" invisible="not requires_pipe" widget="boolean_toggle"/>
                                    <field name="requires_pipe" column_invisible="1"/>
                                </tree>
                            </field>
                            <group class="oe_subtotal_footer oe_right">
                                <field name="total_components" readonly="1"/>
                                <field name="total_cost" readonly="1" widget="monetary" class="oe_subtotal_footer_separator"/>
                            </group>
                        </page>
                        <page string="âš™ï¸ Sections" name="sections">
                            <field name="active_section_ids">
                                <tree>
                                    <field name="sequence" widget="handle"/>
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="icon"/>
                                    <field name="is_mandatory"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Project Tree View -->
    <record id="view_greenhouse_project_tree" model="ir.ui.view">
        <field name="name">greenhouse.project.tree</field>
        <field name="model">greenhouse.project</field>
        <field name="arch" type="xml">
            <tree decoration-success="state == 'confirmed'" decoration-warning="needs_recalculation and state == 'calculated'" decoration-info="state == 'calculated'">
                <field name="reference"/>
                <field name="name"/>
                <field name="customer_name"/>
                <field name="greenhouse_type_id"/>
                <field name="project_date"/>
                <field name="total_components"/>
                <field name="total_cost" widget="monetary"/>
                <field name="state" widget="badge"/>
                <field name="needs_recalculation" column_invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_greenhouse_project" model="ir.actions.act_window">
        <field name="name">Greenhouse Projects</field>
        <field name="res_model">greenhouse.project</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Create your first Greenhouse Project</p>
            <p>Start by selecting a greenhouse type and entering your dimensions. The system will calculate all components automatically!</p>
        </field>
    </record>

    <record id="action_greenhouse_type" model="ir.actions.act_window">
        <field name="name">Greenhouse Types</field>
        <field name="res_model">greenhouse.type</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_greenhouse_section" model="ir.actions.act_window">
        <field name="name">Section Templates</field>
        <field name="res_model">greenhouse.section.template</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Menus -->
    <menuitem id="menu_greenhouse_root" name="ðŸ  Greenhouse" sequence="10"/>
    <menuitem id="menu_greenhouse_project" name="Projects" parent="menu_greenhouse_root" action="action_greenhouse_project" sequence="10"/>
    <menuitem id="menu_greenhouse_config" name="Configuration" parent="menu_greenhouse_root" sequence="100"/>
    <menuitem id="menu_greenhouse_type" name="Greenhouse Types" parent="menu_greenhouse_config" action="action_greenhouse_type" sequence="10"/>
    <menuitem id="menu_greenhouse_section" name="Section Templates" parent="menu_greenhouse_config" action="action_greenhouse_section" sequence="20"/>
</odoo>
