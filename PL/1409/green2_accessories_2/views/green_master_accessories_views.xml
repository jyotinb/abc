<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Inherit Green2's form view to add Accessories functionality -->
    <record id="view_green_master_form_accessories_inherit" model="ir.ui.view">
        <field name="name">green.master.form.accessories.inherit</field>
        <field name="model">green.master</field>
        <field name="inherit_id" ref="green2.view_green_master_form"/>
        <field name="arch" type="xml">
            
            <!-- Add Accessories buttons to header -->
            <xpath expr="//header" position="inside">
                <button name="action_calculate_accessories" 
                        string="üîß Calculate Accessories" 
                        type="object" 
                        class="btn-warning"
                        help="Calculate all accessories based on current configuration"/>
                <button name="action_accessories_summary" 
                        string="üìä Accessories Summary" 
                        type="object" 
                        class="btn-info"
                        help="Show current accessories calculation summary"/>
            </xpath>
            
            <!-- Add Accessories Configuration page -->
            <xpath expr="//notebook/page[last()]" position="after">
                
                <page string="Accessories Configuration">
                    <div class="alert alert-info" role="alert">
                        <h4>üîß Accessories Configuration</h4>
                        <p>Configure which accessories to include in your greenhouse project.</p>
                        <p><strong>Click "Calculate Accessories" to generate components after changing settings.</strong></p>
                    </div>
                    
                    <!-- Border Purlin Clamp Notification -->
                    <div class="alert alert-warning" role="alert" 
                         invisible="no_anchor_frame_lines != 1 or span_side_border_purlin == '0'">
                        <strong>‚ö†Ô∏è Anchor Frame Line Configuration</strong><br/>
                        Single Anchor Frame Line detected. System considers Anchor Frame Lines and ASC (if present) at the same line.<br/>
                        Additional Half Clamps will be calculated using:
                        <ul>
                            <li>ASC Pipe Size (if ASC is present)</li>
                            <li>Big Column Pipe Size (if no ASC)</li>
                        </ul>
                    </div>
                    
                    <separator string="Profile Calculations"/>
                    <div class="row">
                        <div class="col-6">
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Profiles For Arch:</strong></td>
                                    <td><field name="profiles_for_arch" readonly="1"/> m</td>
                                </tr>
                                <tr>
                                    <td><strong>Profile For Purlin:</strong></td>
                                    <td><field name="profile_for_purlin" readonly="1"/> m</td>
                                </tr>
                                <tr>
                                    <td><strong>Profile for Bottom:</strong></td>
                                    <td><field name="profile_for_bottom" readonly="1"/> m</td>
                                </tr>
                                <tr>
                                    <td><strong>Side Profile:</strong></td>
                                    <td><field name="side_profile" readonly="1"/> m</td>
                                </tr>
                                <tr>
                                    <td><strong>Door Profile:</strong></td>
                                    <td><field name="door_profile" readonly="1"/> m</td>
                                </tr>
                                <tr class="table-success">
                                    <td><strong>Total Profile:</strong></td>
                                    <td><strong><field name="total_profile" readonly="1"/> m</strong></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button name="action_calculate_profiles" 
                                string="üìä Calculate Profiles" 
                                type="object" 
                                class="btn btn-success"/>
                    </div>
                    
                    <group>
                        <group string="Bracket Settings">
                            <field name="gutter_bracket_type" widget="radio"/>
							<field name="bay_side_clamp_required" 
           invisible="gutter_bracket_type != 'arch'"
           help="Required when Gutter Arch Brackets are selected. F Brackets don't need bay side clamps as they accommodate like clamps themselves."/>
                            <field name="column_bracket_type" widget="radio"/>
                        </group>
                        <group string="Wire &amp; Connector Settings">
                            <field name="enable_zigzag_wire"/>
                            <field name="zigzag_wire_size" invisible="not enable_zigzag_wire" widget="radio"/>
                            <field name="enable_rollup_connectors"/>
                        </group>
                        <group string="Foundation Settings">
                            <field name="enable_foundation_rods"/>
                            <field name="foundation_rods_per_foundation" invisible="not enable_foundation_rods"/>
                            <field name="foundation_rods_per_asc" invisible="not enable_foundation_rods"/>
                        </group>
                        </group>
                        <group string="Advanced Clamp Settings">
                            <field name="clamp_type" widget="radio"/>
							
							<!-- W Type Options -->
                            <group invisible="clamp_type != 'w_type'" string="W Type Configuration">
                                <group string="Big Purlin Clamps">
                                    <field name="big_purlin_clamp_type_first" 
                                           widget="radio" 
                                           string="First Type (No of Spans √ó 2)"/>
                                    <field name="big_purlin_clamp_type_second" 
                                           widget="radio"
                                           string="Second Type (Remaining)"/>
                                </group>
                                <group string="Small Purlin Clamps">
                                    <field name="small_purlin_clamp_type_first" 
                                           widget="radio"
                                           string="First Type (No of Spans √ó 2)"/>
                                    <field name="small_purlin_clamp_type_second" 
                                           widget="radio"
                                           string="Second Type (Remaining)"/>
                                </group>
                            </group>
                            
                            <!-- M Type Options -->
                            <group invisible="clamp_type != 'm_type'" string="M Type Configuration">
                                <field name="bottom_chord_clamp_type" 
                                       widget="radio"
                                       string="Bottom Chord Clamp Type"/>
                            </group>
                            
                            <!-- Add Details button -->
                            <button name="action_view_clamp_details" 
                                    string="üìä View Clamp Details" 
                                    type="object" 
                                    class="btn-info"
                                    invisible="clamp_type == 'none' and not (is_side_coridoors and support_hockeys > 0) and bay_side_border_purlin == '0' and span_side_border_purlin == '0'"
                                    help="Show detailed breakdown of clamp calculations including border purlins"/>
                            
                            
                            
                            <!-- Border Purlin Clamp Settings -->
                            <group string="Border Purlin Clamp Settings" 
                                   invisible="bay_side_border_purlin == '0' and span_side_border_purlin == '0'">
                                <!-- <group> -->
                                    <!-- <div class="alert alert-info" role="alert"> -->
                                        <strong>‚ÑπÔ∏è Border Purlin Clamps Active</strong><br/>
                                        <span invisible="bay_side_border_purlin == '0'">
                                            Bay Side Border Purlin: <field name="bay_side_border_purlin" readonly="1" class="oe_inline"/> configured<br/>
                                        </span>
                                        <span invisible="span_side_border_purlin == '0'">
                                            Span Side Border Purlin: <field name="span_side_border_purlin" readonly="1" class="oe_inline"/> configured<br/>
                                        </span>
                                        <span invisible="no_anchor_frame_lines == 0">
                                            Anchor Frame Lines: <field name="no_anchor_frame_lines" readonly="1" class="oe_inline"/> lines<br/>
                                        </span>
                                        <br/>
                                        <strong>Clamps will be calculated based on:</strong>
                                        <span >ASC presence (if enabled)
                                        Thick Column configuration
                                        Main/Big/Thick Column pipe sizes</span >
                                    <!-- </div> -->
                                <!-- </group> -->
                                
                                <!-- Show configuration summary -->
                                <group string="Border Purlin Configuration">
                                    <field name="bay_side_border_purlin" readonly="1"/>
                                    <field name="span_side_border_purlin" readonly="1"/>
                                    <field name="no_anchor_frame_lines" readonly="1"/>
                                    <field name="thick_column" readonly="1"/>
                                </group>
                            </group>
                        </group>
                    <!-- </group> -->
                    
                    <separator string="Accessories Cost Summary"/>
                    <group col="4">
                        <field name="total_profiles_cost" readonly="1" widget="monetary"/>
                        <field name="total_brackets_cost" readonly="1" widget="monetary"/>
                        <field name="total_wires_connectors_cost" readonly="1" widget="monetary"/>
                        <field name="total_clamps_cost" readonly="1" widget="monetary"/>
                        <field name="total_foundation_cost" readonly="1" widget="monetary"/>
                        <field name="total_accessories_cost" readonly="1" widget="monetary"/>
                    </group>
                    
                    <div class="row mt-3">
                        <div class="col-12 text-center">
                            <button name="action_calculate_accessories" 
                                    string="üîß Calculate Accessories" 
                                    type="object" 
                                    class="btn btn-warning btn-lg"/>
                        </div>
                    </div>
                </page>
                
                <!-- Add Accessories Management page -->
                <page string="Accessories Management">
                    <div class="alert alert-info" role="alert">
                        <strong>üîß Excel-Style Accessories Management</strong><br/>
                        Edit accessory components directly in tables below. All calculations update automatically.
                    </div>
                    
                    <!-- Action Buttons Panel -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">üöÄ Accessories Actions</h5>
                                </div>
                                <div class="card-body text-center">
                                    <div class="btn-group" role="group">
                                        <button name="action_calculate_accessories" 
                                                string="üîß Calculate Accessories" 
                                                type="object" 
                                                class="btn btn-warning btn-lg"/>
                                        <button name="action_accessories_summary" 
                                                string="üìä Show Summary" 
                                                type="object" 
                                                class="btn btn-info btn-lg"/>
                                        <button name="action_view_clamp_details" 
                                                string="üìä Clamp Details" 
                                                type="object" 
                                                class="btn btn-secondary btn-lg"
                                                invisible="clamp_type == 'none' and not (is_side_coridoors and support_hockeys > 0) and bay_side_border_purlin == '0' and span_side_border_purlin == '0'"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profiles Components -->
                    <div class="card mb-4" invisible="not profiles_component_ids">
                        <div class="card-header bg-success text-white">
                            <h4 class="mb-0">üìè Profiles Components</h4>
                        </div>
                        <div class="card-body">
                            <field name="profiles_component_ids" readonly="0"/>
                            <div class="text-right mt-2">
                                <h5 class="text-success">Profiles Total: <field name="total_profiles_cost" readonly="1" widget="monetary"/></h5>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Brackets Components -->
                    <div class="card mb-4" invisible="not brackets_component_ids">
                        <div class="card-header bg-warning text-white">
                            <h4 class="mb-0">üîß Brackets Components</h4>
                        </div>
                        <div class="card-body">
                            <field name="brackets_component_ids" readonly="0"/>
                            <div class="text-right mt-2">
                                <h5 class="text-warning">Brackets Total: <field name="total_brackets_cost" readonly="1" widget="monetary"/></h5>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wires & Connectors Components -->
                    <div class="card mb-4" invisible="not wires_connectors_component_ids">
                        <div class="card-header bg-info text-white">
                            <h4 class="mb-0">üîó Wires &amp; Connectors</h4>
                        </div>
                        <div class="card-body">
                            <field name="wires_connectors_component_ids" readonly="0"/>
                            <div class="text-right mt-2">
                                <h5 class="text-info">Wires &amp; Connectors Total: <field name="total_wires_connectors_cost" readonly="1" widget="monetary"/></h5>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Clamps Components -->
                    <div class="card mb-4" invisible="not clamps_component_ids">
                        <div class="card-header bg-secondary text-white">
                            <h4 class="mb-0">
                                üõ†Ô∏è Clamps Components
                                <span invisible="clamp_type != 'w_type'" class="badge badge-light ml-2">W Type</span>
                                <span invisible="clamp_type != 'm_type'" class="badge badge-light ml-2">M Type</span>
                                <span invisible="not (is_side_coridoors and support_hockeys > 0)" class="badge badge-warning ml-2">ASC Support</span>
                                <span invisible="not (bay_side_border_purlin != '0' or span_side_border_purlin != '0')" 
                                      class="badge badge-info ml-2">Border Purlins</span>
                            </h4>
                        </div>
                        <div class="card-body">
                            <field name="clamps_component_ids" readonly="0"/>
                            <div invisible="not clamps_size_summary" class="alert alert-info mt-2">
                                <strong>Size Summary:</strong> <field name="clamps_size_summary" readonly="1" nolabel="1"/>
                            </div>
                            <div invisible="not border_purlin_clamps_summary" class="alert alert-warning mt-2">
                                <strong>Border Purlin Config:</strong> <field name="border_purlin_clamps_summary" readonly="1" nolabel="1"/>
                            </div>
                            <div class="text-right mt-2">
                                <h5 class="text-secondary">Clamps Total: <field name="total_clamps_cost" readonly="1" widget="monetary"/></h5>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Foundation Components -->
                    <div class="card mb-4" invisible="not foundation_component_ids">
                        <div class="card-header bg-danger text-white">
                            <h4 class="mb-0">‚öì Foundation Components</h4>
                        </div>
                        <div class="card-body">
                            <field name="foundation_component_ids" readonly="0"/>
                            <div class="text-right mt-2">
                                <h5 class="text-danger">Foundation Total: <field name="total_foundation_cost" readonly="1" widget="monetary"/></h5>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Accessories Total Panel -->
                    <div class="card border-warning mb-4">
                        <div class="card-header bg-warning text-white text-center">
                            <h3 class="mb-0">üîß ACCESSORIES TOTAL: <field name="total_accessories_cost" readonly="1" widget="monetary"/></h3>
                        </div>
                        <div class="card-body text-center">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Profiles</h6>
                                            <p class="card-text h5"><field name="total_profiles_cost" readonly="1" widget="monetary"/></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Brackets</h6>
                                            <p class="card-text h5"><field name="total_brackets_cost" readonly="1" widget="monetary"/></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Wires &amp; Connectors</h6>
                                            <p class="card-text h5"><field name="total_wires_connectors_cost" readonly="1" widget="monetary"/></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Clamps</h6>
                                            <p class="card-text h5"><field name="total_clamps_cost" readonly="1" widget="monetary"/></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Foundation</h6>
                                            <p class="card-text h5"><field name="total_foundation_cost" readonly="1" widget="monetary"/></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </page>
                
            </xpath>
            
            <!-- Add accessories to Component Management page summary -->
            <xpath expr="//div[contains(@class, 'card') and .//h3[contains(text(), 'PROJECT TOTAL')]]" position="before">
                <div class="card border-warning mb-4">
                    <div class="card-header bg-warning text-white text-center">
                        <h4 class="mb-0">üîß ACCESSORIES SUMMARY</h4>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-borderless">
                            <tr>
                                <td><strong>üìè Profiles:</strong></td>
                                <td class="text-right"><field name="total_profiles_cost" readonly="1" widget="monetary"/></td>
                            </tr>
                            <tr>
                                <td><strong>üîß Brackets:</strong></td>
                                <td class="text-right"><field name="total_brackets_cost" readonly="1" widget="monetary"/></td>
                            </tr>
                            <tr>
                                <td><strong>üîó Wires &amp; Connectors:</strong></td>
                                <td class="text-right"><field name="total_wires_connectors_cost" readonly="1" widget="monetary"/></td>
                            </tr>
                            <tr>
                                <td><strong>üõ†Ô∏è Clamps:</strong></td>
                                <td class="text-right"><field name="total_clamps_cost" readonly="1" widget="monetary"/></td>
                            </tr>
                            <tr>
                                <td><strong>‚öì Foundation:</strong></td>
                                <td class="text-right"><field name="total_foundation_cost" readonly="1" widget="monetary"/></td>
                            </tr>
                            <tr class="table-warning">
                                <td><strong>üîß TOTAL ACCESSORIES:</strong></td>
                                <td class="text-right"><strong><field name="total_accessories_cost" readonly="1" widget="monetary"/></strong></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </xpath>
            
            <!-- Update Cost Summary page -->
            <xpath expr="//tr[contains(@class, 'table-danger') and .//field[@name='grand_total_cost']]" position="before">
                <tr class="table-info">
                    <td><strong>üîß Brackets</strong></td>
                    <td class="text-right"><field name="total_brackets_cost" readonly="1" widget="monetary"/></td>
                </tr>
                <tr class="table-info">
                    <td><strong>üîó Wires &amp; Connectors</strong></td>
                    <td class="text-right"><field name="total_wires_connectors_cost" readonly="1" widget="monetary"/></td>
                </tr>
                <tr class="table-info">
                    <td><strong>üõ†Ô∏è Clamps</strong></td>
                    <td class="text-right"><field name="total_clamps_cost" readonly="1" widget="monetary"/></td>
                </tr>
                <tr class="table-info">
                    <td><strong>üìè Profiles</strong></td>
                    <td class="text-right"><field name="total_profiles_cost" readonly="1" widget="monetary"/></td>
                </tr>
                <tr class="table-info">
                    <td><strong>‚öì Foundation</strong></td>
                    <td class="text-right"><field name="total_foundation_cost" readonly="1" widget="monetary"/></td>
                </tr>
                <tr class="table-warning">
                    <td><strong>üîß TOTAL ACCESSORIES</strong></td>
                    <td class="text-right"><field name="total_accessories_cost" readonly="1" widget="monetary"/></td>
                </tr>
            </xpath>
            
        </field>
    </record>
    
    <!-- Tree view inherit -->
    <record id="view_green_master_tree_accessories_inherit" model="ir.ui.view">
        <field name="name">green.master.tree.accessories.inherit</field>
        <field name="model">green.master</field>
        <field name="inherit_id" ref="green2.view_green_master_tree"/>
        <field name="arch" type="xml">
            <field name="grand_total_cost" position="before">
                <field name="total_accessories_cost" optional="hide" sum="Total Accessories"/>
            </field>
            
            <button name="print_report" position="after">
                <button name="action_calculate_accessories" 
                        string="üîß Calc Acc" 
                        type="object" 
                        class="btn-warning" 
                        help="Calculate accessories"/>
            </button>
        </field>
    </record>
    
</odoo>